<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="UTF-8">
  <title>Dosije ocenjenog člana</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .breadcrumb {
      font-size: 14px;
      margin-bottom: 20px;
      color: #555;
    }

    .breadcrumb a {
      color: #007bff;
      text-decoration: none;
    }

    .breadcrumb a:hover {
      text-decoration: underline;
    }

    .main-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .sub-title {
      font-size: 18px;
      margin-top: 30px;
      font-weight: bold;
      border-bottom: 1px solid #ccc;
      padding-bottom: 5px;
    }

    .ocenjivanje-tabela {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    .ocenjivanje-tabela th,
    .ocenjivanje-tabela td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: left;
    }

    .ocenjivanje-tabela th {
      background-color: #f0f0f0;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="breadcrumb">
      <a href="index.html">Home</a> &gt;
      <a href="my-log.html">Moj dnevnik ocenjivanja</a> &gt;
      Ocenjeni član
    </div>

    <div class="main-title">Ocenjeni član: <span id="ime-prezime">Učitavanje...</span></div>

    <table class="ocenjivanje-tabela">
      <thead>
        <tr>
          <th>Kategorije:</th>
          <th>Moje ocene:</th>
          <th>Parametri:</th>
        </tr>
      </thead>
      <tbody id="tabela-ocene">
        <!-- Dinamika dolazi u sledećim fazama -->
      </tbody>
    </table>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const ime = params.get("name") || "";
    const prezime = params.get("surname") || "";
    const ratedName = `${ime} ${prezime}`.trim();
    document.getElementById("ime-prezime").innerText = ratedName;

    // Ime trenutno ulogovanog korisnika (pretpostavimo da je sačuvan u localStorage)
    const loggedUser = localStorage.getItem("userFullName");

    fetch(`/api/ratings/dossier?raterName=${loggedUser}&ratedName=${ratedName}`)
      .then(res => res.json())
      .then(data => {
        const tabela = document.getElementById("tabela-ocene");
        data.forEach(entry => {
          const row = document.createElement("tr");

          const kategorijaCell = document.createElement("td");
          kategorijaCell.textContent = entry.subcategory || "-";

          const ocenaCell = document.createElement("td");
          ocenaCell.textContent = entry.rating || "-";

          const parametriCell = document.createElement("td");
          parametriCell.textContent = entry.timestamp
            ? new Date(entry.timestamp).toLocaleString()
            : "-";

          row.appendChild(kategorijaCell);
          row.appendChild(ocenaCell);
          row.appendChild(parametriCell);
          tabela.appendChild(row);
        });
      })
      .catch(err => {
        console.error("Greška:", err);
      });

  </script>
</body>
</html>
