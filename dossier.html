
      data.forEach(entry => {
        const sub = entry.cardSub || "-";

        if (glavneKategorije.includes(sub)) {
          // Direktno ocenjivanje glavne kategorije
          if (!grouped[sub]) grouped[sub] = { glavno: null, pods: [] };
          grouped[sub].glavno = entry;
        } else {
          const main = subToMainCategory[sub] || "Nepoznata kategorija";
          if (!grouped[main]) grouped[main] = { glavno: null, pods: [] };
          grouped[main].pods.push(entry);
        }
      });

      Object.entries(grouped).forEach(([main, { glavno, pods }]) => {
        const mainRow = document.createElement("tr");

        const mainCell = document.createElement("td");
        mainCell.textContent = main;
        mainCell.style.fontWeight = "bold";
        mainCell.style.fontSize = "16px";

        const scoreCell = document.createElement("td");
        const paramCell = document.createElement("td");

        const v = pods.filter(e => typeof e.score === 'number').length;
        const y = Object.entries(subToMainCategory).filter(([sub, cat]) => cat === main).length;
        const w = y - v;
        const a = pods.reduce((acc, e) => acc + (typeof e.score === 'number' ? e.score : 0), 0);
        const b = w * 5;
        const x = a + b;
        const z = y > 0 ? x / y : "-";

        if (glavno) {
          scoreCell.textContent = glavno.score ?? "-";
        } else {
          scoreCell.textContent = "";
        }

        paramCell.innerHTML = `a = ${a} ; b = ${b} ; x = ${x} ; v = ${v} ; w = ${w} ; y = ${y} ; z = ${z}`;

        mainRow.appendChild(mainCell);
        mainRow.appendChild(scoreCell);
        mainRow.appendChild(paramCell);
        tabela.appendChild(mainRow);

        // Dodaj potkategorije
        pods.forEach(e => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${e.cardSub || "-"}</td>
            <td>${e.score ?? "-"}</td>
            <td>${e.timestamp ? new Date(e.timestamp).toLocaleString() : "-"}</td>
          `;
          tabela.appendChild(row);
        });
      });
    })
    .catch(err => {
      console.error("Greška:", err);
      document.getElementById("tabela-ocene").innerHTML = '<tr><td colspan="3">Greška pri učitavanju podataka.</td></tr>';
    });
}
</script>
</body>
</html>
